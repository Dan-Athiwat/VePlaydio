<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Real Video Social App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <style>
        :root { --primary: #fe2c55; --dark: #121212; --text: #fff; }
        body { margin: 0; background: var(--dark); color: var(--text); font-family: sans-serif; overflow: hidden; height: 100vh; }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        /* Login */
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;}
        .google-btn { background: white; color: #333; padding: 12px 24px; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; gap: 10px; align-items: center; }

        /* Main App */
        #app-container { display: none; height: 100%; flex-direction: column; }
        
        /* Feed */
        #video-feed { flex: 1; overflow-y: scroll; scroll-snap-type: y mandatory; background: black; position: relative; }
        .video-container { height: 100%; width: 100%; scroll-snap-align: start; position: relative; background: #000; display:flex; justify-content:center; align-items:center; }
        video { width: 100%; height: 100%; object-fit: contain; } /* เปลี่ยนเป็น contain ให้เห็นครบ */

        /* UI Overlays */
        .top-bar { position: absolute; top: 0; width: 100%; padding: 15px; display: flex; justify-content: space-between; z-index: 10; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent); pointer-events: none; }
        .top-bar > * { pointer-events: auto; }
        .feed-tabs span { margin: 0 10px; opacity: 0.7; font-weight: bold; cursor: pointer; }
        .feed-tabs span.active { opacity: 1; border-bottom: 2px solid white; }

        .video-ui { position: absolute; bottom: 60px; left: 0; width: 100%; padding: 15px; display: flex; justify-content: space-between; align-items: flex-end; z-index: 10; text-shadow: 1px 1px 2px black; }
        .video-info { max-width: 75%; }
        .action-bar { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .action-btn { text-align: center; cursor: pointer; }
        .action-btn i { font-size: 28px; margin-bottom: 5px; transition: 0.2s; }
        .liked { color: var(--primary); }
        .saved { color: #ffd700; }

        /* Bottom Nav */
        .bottom-nav { height: 55px; background: black; border-top: 1px solid #333; display: flex; justify-content: space-around; align-items: center; z-index: 20; }
        .nav-item { color: #888; font-size: 22px; cursor: pointer; }
        .create-btn { width: 45px; height: 30px; background: linear-gradient(to right, #00f2ea, #ff0050); border-radius: 8px; display: flex; justify-content: center; align-items: center; color: white; font-size: 16px; }

        /* Overlays (Search, Profile, Upload) */
        .full-page { position: fixed; inset: 0; background: #121212; z-index: 100; display: none; flex-direction: column; }
        .header { padding: 15px; border-bottom: 1px solid #333; display: flex; align-items: center; gap: 10px; font-weight: bold; }
        .content { flex: 1; overflow-y: auto; padding: 15px; }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; }
        .grid-item { aspect-ratio: 3/4; background: #333; position: relative; }
        .grid-item video { width: 100%; height: 100%; object-fit: cover; }

        /* Form Elements */
        input, textarea { width: 100%; background: #333; border: none; color: white; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #555; }

        /* Settings Menu */
        .side-menu { position: fixed; top: 0; right: -250px; width: 250px; height: 100%; background: #222; z-index: 200; transition: 0.3s; padding: 20px; }
        .side-menu.open { right: 0; }
        .menu-item { padding: 15px 0; border-bottom: 1px solid #333; cursor: pointer; display: flex; justify-content: space-between; }

        /* Loading Spinner */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display:none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .vinyl { animation: spin 5s linear infinite; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color:white; margin-bottom:20px;">Video Social Real</h1>
        <div class="google-btn" onclick="authLogin()">
            <i class="fab fa-google"></i> ลงชื่อเข้าใช้ Google
        </div>
    </div>

    <div id="app-container">
        <div class="top-bar" id="top-ui">
            <div class="feed-tabs">
                <span onclick="loadFeed('following')">กำลังติดตาม</span> | 
                <span class="active" onclick="loadFeed('popular')">ยอดนิยม</span>
            </div>
            <div>
                <i class="fas fa-search" onclick="openPage('search-page')"></i>
                <i class="fas fa-bars" style="margin-left:15px;" onclick="toggleMenu()"></i>
            </div>
        </div>

        <div id="video-feed"></div>

        <div class="side-menu" id="side-menu">
            <h3>การตั้งค่า</h3>
            <div class="menu-item" onclick="toggleHideLikes()">
                <span>ซ่อนยอดกดใจ</span> <i class="fas fa-toggle-on" id="icon-hide-likes"></i>
            </div>
            <div class="menu-item" onclick="toggleUI()">
                <span>ซ่อน UI</span> <i class="fas fa-eye-slash"></i>
            </div>
            <div class="menu-item" onclick="authLogout()" style="color:var(--primary)">ออกจากระบบ</div>
        </div>

        <div class="bottom-nav" id="bottom-ui">
            <div class="nav-item" onclick="loadFeed('popular')"><i class="fas fa-home"></i></div>
            <div class="nav-item"><i class="fas fa-user-friends"></i></div>
            <div class="nav-item" onclick="openUploadPage()"><div class="create-btn"><i class="fas fa-plus"></i></div></div>
            <div class="nav-item"><i class="fas fa-inbox"></i></div>
            <div class="nav-item" onclick="openMyProfile()"><i class="fas fa-user"></i></div>
        </div>
    </div>

    <div id="upload-page" class="full-page">
        <div class="header"><i class="fas fa-arrow-left" onclick="closePage('upload-page')"></i> สร้างคลิป</div>
        <div class="content">
            <div style="text-align:center; padding: 20px; border: 2px dashed #444; margin-bottom: 20px;" onclick="document.getElementById('file-input').click()">
                <i class="fas fa-cloud-upload-alt" style="font-size:40px;"></i><br>เลือกวีดีโอ
            </div>
            <input type="file" id="file-input" accept="video/*" hidden onchange="previewUpload(this)">
            <video id="preview-video" style="width:100%; height:200px; display:none;" controls></video>
            
            <input type="text" id="up-title" placeholder="ชื่อคลิป">
            <textarea id="up-desc" placeholder="คำอธิบาย..." rows="3"></textarea>
            
            <div id="sound-select-display" style="margin-bottom:10px; color:#888; font-size:12px;">
                <i class="fas fa-music"></i> <span id="selected-sound-name">เสียงต้นฉบับ</span>
            </div>

            <div class="loader" id="upload-loader"></div>
            <button class="btn" onclick="uploadVideo()">อัพโหลด (ห้ามเกิน 10 นาที)</button>
        </div>
    </div>

    <div id="search-page" class="full-page">
        <div class="header">
            <i class="fas fa-arrow-left" onclick="closePage('search-page')"></i>
            <input type="text" id="search-input" placeholder="ค้นหา..." style="margin:0; width:auto; flex:1;">
            <i class="fas fa-search" onclick="doSearch()"></i>
        </div>
        <div class="content">
            <div class="grid" id="search-results"></div>
        </div>
    </div>

    <div id="profile-page" class="full-page">
        <div class="header">
            <i class="fas fa-arrow-left" onclick="closePage('profile-page')"></i>
            <span id="prof-name-header">...</span>
        </div>
        <div class="content" style="text-align:center;">
            <img id="prof-pic" src="" style="width:100px; height:100px; border-radius:50%; margin:10px;">
            <h2 id="prof-name">...</h2>
            
            <div style="display:flex; justify-content:center; gap:20px; margin:15px 0;">
                <div><b id="stat-following">0</b><br><small>กำลังติดตาม</small></div>
                <div><b id="stat-followers">0</b><br><small>ผู้ติดตาม</small></div>
                <div><b id="stat-likes">0</b><br><small>ถูกใจ</small></div>
            </div>

            <div id="prof-actions" style="margin-bottom:20px;"></div>

            <div style="display:flex; border-bottom:1px solid #333; margin-bottom:10px;">
                <div style="flex:1; padding:10px; border-bottom:2px solid white;">คลิป</div>
                <div style="flex:1; padding:10px; color:#888;">ใจ</div>
            </div>
            <div class="grid" id="profile-grid"></div>
        </div>
    </div>

    <div id="edit-profile-page" class="full-page" style="z-index: 150;">
        <div class="header"><i class="fas fa-arrow-left" onclick="closePage('edit-profile-page')"></i> แก้ไขโปรไฟล์</div>
        <div class="content">
            <label>ชื่อ (เปลี่ยนได้ทุก 7 วัน)</label>
            <input type="text" id="edit-name-val">
            <button class="btn" onclick="saveProfileName()">บันทึก</button>
            <p id="edit-error" style="color:red; display:none;">ยังไม่ครบ 7 วัน</p>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. การตั้งค่า Firebase (สำคัญมาก!)
        // ==========================================
        const firebaseConfig = {
  apiKey: "AIzaSyB575txzpvEoiUPGAzMWmBIJ-AumUrPZ04",
  authDomain: "mychatapp-6553a.firebaseapp.com",
  databaseURL: "https://mychatapp-6553a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mychatapp-6553a",
  storageBucket: "mychatapp-6553a.firebasestorage.app",
  messagingSenderId: "327022378740",
  appId: "1:327022378740:web:381b0688ed36b48a90e8a1",
  measurementId: "G-X4LL87Q0Z4"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        let currentUser = null;
        let currentSound = { name: "เสียงต้นฉบับ", id: "original" };

        // ==========================================
        // 2. Authentication (Login/Logout)
        // ==========================================
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                checkUserDoc(user); // สร้างเอกสาร User ใน DB ถ้ายังไม่มี
                loadFeed('popular');
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-container').style.display = 'none';
            }
        });

        function authLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(e => alert("Login Error: " + e.message));
        }

        function authLogout() { auth.signOut(); location.reload(); }

        async function checkUserDoc(user) {
            const docRef = db.collection('users').doc(user.uid);
            const doc = await docRef.get();
            if (!doc.exists) {
                await docRef.set({
                    uid: user.uid,
                    name: user.displayName,
                    pic: user.photoURL,
                    email: user.email,
                    searchParams: [user.displayName.toLowerCase()], // สำหรับค้นหา
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastInfoChange: 0, // สำหรับเช็ค 7 วัน
                    settings: { hideLikes: false }
                });
            }
        }

        // ==========================================
        // 3. Feed & Video Logic
        // ==========================================
        async function loadFeed(type) {
            const feedDiv = document.getElementById('video-feed');
            feedDiv.innerHTML = '<div style="text-align:center; padding:20px;">กำลังโหลด...</div>';
            
            let query = db.collection('videos').orderBy('timestamp', 'desc').limit(20);
            
            if (type === 'following') {
                // ของจริงต้องทำ Array contains แต่เพื่อให้ง่าย ดึงมาหมดแล้วกรองเอา (ใน Production ไม่ควรทำแบบนี้)
                // เนื่องจาก Firestore Query ซับซ้อน เราจะโหลดแบบ Simple ก่อน
                const myDoc = await db.collection('users').doc(currentUser.uid).get();
                const following = myDoc.data().following || [];
                if (following.length === 0) {
                    feedDiv.innerHTML = '<div style="text-align:center; margin-top:50%; color:#888;">คุณยังไม่ได้ติดตามใคร</div>';
                    return;
                }
                // *หมายเหตุ: ของจริงต้องใช้ where('uid', 'in', following) แต่จำกัด 10 คน
            }

            const snapshot = await query.get();
            feedDiv.innerHTML = ''; // Clear

            if(snapshot.empty) {
                feedDiv.innerHTML = '<div style="text-align:center; margin-top:50%;">ไม่มีคลิป</div>';
                return;
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                if(type === 'following') {
                     // Filter client side (ง่ายสุดสำหรับการสาธิต)
                     // ต้องไปดึง list following มาเช็ค
                }
                createVideoElement(doc.id, data, feedDiv);
            });
            
            setupObserver();
        }

        function createVideoElement(vidId, data, container) {
            const div = document.createElement('div');
            div.className = 'video-container';
            const isMine = data.uid === currentUser.uid;
            
            // HTML Structure
            div.innerHTML = `
                <video src="${data.url}" loop playsinline onclick="togglePlay(this)"></video>
                <div class="video-ui">
                    <div class="video-info">
                        <div style="font-weight:bold; margin-bottom:5px; cursor:pointer;" onclick="openUserProfile('${data.uid}')">@${data.uploaderName}</div>
                        <div style="margin-bottom:5px;">${data.title}</div>
                        <small style="color:#ccc;">${new Date(data.timestamp?.toDate()).toLocaleDateString()}</small>
                        <div style="margin-top:10px; font-size:12px;" onclick="useSound('${data.soundName}', '${data.soundId}')">
                            <i class="fas fa-music"></i> ${data.soundName}
                        </div>
                    </div>
                    <div class="action-bar">
                        <div style="position:relative;" onclick="openUserProfile('${data.uid}')">
                            <img src="${data.uploaderPic}" style="width:45px; height:45px; border-radius:50%; border:2px solid white;">
                        </div>
                        <div class="action-btn" onclick="likeVideo('${vidId}', this)">
                            <i class="fas fa-heart"></i> <span class="like-count">${data.likesCount || 0}</span>
                        </div>
                        <div class="action-btn" onclick="alert('Feature Comment ต้องสร้าง Subcollection')">
                            <i class="fas fa-comment-dots"></i> <span>0</span>
                        </div>
                        <div class="action-btn" onclick="saveVideo('${vidId}', this)">
                            <i class="fas fa-bookmark"></i> <span>บันทึก</span>
                        </div>
                         <div class="action-btn" onclick="shareVideo()">
                            <i class="fas fa-share"></i> <span>แชร์</span>
                        </div>
                         <div class="vinyl" style="width:40px; height:40px; background:#222; border-radius:50%; display:flex; justify-content:center; align-items:center; border:5px solid #111;" onclick="useSound('${data.soundName}', '${data.soundId}')">
                            <img src="${data.uploaderPic}" style="width:20px; height:20px; border-radius:50%;">
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(div);
            
            // Check status (Like/Save) - ต้องดึงจาก Subcollection ของ user หรือ video (ทำแบบย่อ)
            checkInteractionStatus(vidId, div);
        }

        function togglePlay(video) {
            if (video.paused) video.play(); else video.pause();
        }

        function setupObserver() {
            let observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    let vid = entry.target.querySelector('video');
                    if(entry.isIntersecting) vid.play();
                    else vid.pause();
                });
            }, { threshold: 0.6 });
            document.querySelectorAll('.video-container').forEach(el => observer.observe(el));
        }

        // ==========================================
        // 4. Interaction (Like/Save/Follow)
        // ==========================================
        async function likeVideo(vidId, btn) {
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            const vidRef = db.collection('videos').doc(vidId);
            const likeRef = vidRef.collection('likes').doc(currentUser.uid); // ใช้ subcollection

            const doc = await likeRef.get();
            if(doc.exists) {
                // Unlike
                await likeRef.delete();
                await vidRef.update({ likesCount: firebase.firestore.FieldValue.increment(-1) });
                icon.classList.remove('liked');
                span.innerText = parseInt(span.innerText) - 1;
            } else {
                // Like
                await likeRef.set({ timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                await vidRef.update({ likesCount: firebase.firestore.FieldValue.increment(1) });
                icon.classList.add('liked');
                span.innerText = parseInt(span.innerText) + 1;
            }
        }

        async function checkInteractionStatus(vidId, div) {
            // เช็คว่าเคยกดใจไหม
            const likeDoc = await db.collection('videos').doc(vidId).collection('likes').doc(currentUser.uid).get();
            if(likeDoc.exists) div.querySelector('.fa-heart').classList.add('liked');
        }

        async function followUser(targetUid, btn) {
            if(targetUid === currentUser.uid) return;
            const myRef = db.collection('users').doc(currentUser.uid);
            
            // ในความจริงควรใช้ Subcollection 'following' ถ้าคนติดตามเยอะๆ แต่เพื่อความง่ายใช้อาร์เรย์
            // (ข้อจำกัด: อาร์เรย์รับได้ไม่เกินลิมิต Firestore document size)
            
            const myDoc = await myRef.get();
            let following = myDoc.data().following || [];
            
            if(following.includes(targetUid)) {
                // Unfollow
                await myRef.update({ following: firebase.firestore.FieldValue.arrayRemove(targetUid) });
                btn.innerText = "ติดตาม";
                btn.style.background = "#fe2c55";
            } else {
                // Follow
                await myRef.update({ following: firebase.firestore.FieldValue.arrayUnion(targetUid) });
                btn.innerText = "เลิกติดตาม";
                btn.style.background = "#555";
            }
        }

        // ==========================================
        // 5. Upload & Storage
        // ==========================================
        function openUploadPage() { document.getElementById('upload-page').style.display = 'flex'; }
        
        function previewUpload(input) {
            const file = input.files[0];
            if(!file) return;
            // เช็ค 10 นาที (คร่าวๆ เช็คขนาดก่อน)
            if(file.size > 100 * 1024 * 1024) { alert("ไฟล์ใหญ่เกินไป (demo limit)"); return; } 
            
            const url = URL.createObjectURL(file);
            const vid = document.getElementById('preview-video');
            vid.src = url;
            vid.style.display = 'block';
            vid.onloadedmetadata = () => {
                if(vid.duration > 600) { alert("เกิน 10 นาที!"); input.value = ''; vid.style.display='none'; }
            };
        }
        
        function useSound(name, id) {
            currentSound = { name: name, id: id };
            document.getElementById('selected-sound-name').innerText = name;
            openUploadPage();
        }

        async function uploadVideo() {
            const file = document.getElementById('file-input').files[0];
            const title = document.getElementById('up-title').value;
            
            if(!file || !title) return alert("กรุณาเลือกไฟล์และใส่ชื่อ");

            document.getElementById('upload-loader').style.display = 'block';
            const btn = document.querySelector('#upload-page .btn');
            btn.disabled = true;

            try {
                // 1. Upload File
                const storageRef = storage.ref(`videos/${Date.now()}_${file.name}`);
                const snapshot = await storageRef.put(file);
                const url = await snapshot.ref.getDownloadURL();

                // 2. Save Data to Firestore
                await db.collection('videos').add({
                    uid: currentUser.uid,
                    uploaderName: currentUser.displayName,
                    uploaderPic: currentUser.photoURL,
                    url: url,
                    title: title,
                    desc: document.getElementById('up-desc').value,
                    soundName: currentSound.name,
                    soundId: currentSound.id,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    likesCount: 0,
                    searchKeywords: title.toLowerCase().split(" ")
                });

                alert("อัพโหลดสำเร็จ!");
                closePage('upload-page');
                loadFeed('popular'); // Refresh
            } catch (error) {
                alert("Upload failed: " + error.message);
            } finally {
                document.getElementById('upload-loader').style.display = 'none';
                btn.disabled = false;
            }
        }

        // ==========================================
        // 6. Profile & Settings
        // ==========================================
        async function openUserProfile(uid) {
            if(!uid) uid = currentUser.uid;
            const page = document.getElementById('profile-page');
            const grid = document.getElementById('profile-grid');
            grid.innerHTML = 'Loading...';
            page.style.display = 'flex';

            const userDoc = await db.collection('users').doc(uid).get();
            const userData = userDoc.data();

            document.getElementById('prof-name').innerText = "@" + userData.name;
            document.getElementById('prof-pic').src = userData.pic;

            // Setup Actions
            const actionDiv = document.getElementById('prof-actions');
            actionDiv.innerHTML = '';
            
            if(uid === currentUser.uid) {
                actionDiv.innerHTML = `<button class="btn" style="width:auto; padding:5px 15px; background:transparent; border:1px solid #555;" onclick="openEditProfile()">แก้ไขโปรไฟล์</button>`;
            } else {
                // Check follow status
                const myDoc = await db.collection('users').doc(currentUser.uid).get();
                const following = myDoc.data().following || [];
                const isFollowing = following.includes(uid);
                
                actionDiv.innerHTML = `<button class="btn" style="width:auto; padding:5px 20px; background:${isFollowing?'#555':'#fe2c55'}" onclick="followUser('${uid}', this)">${isFollowing?'เลิกติดตาม':'ติดตาม'}</button>`;
            }

            // Load Videos
            const vids = await db.collection('videos').where('uid', '==', uid).orderBy('timestamp', 'desc').get();
            grid.innerHTML = '';
            vids.forEach(doc => {
                const d = doc.data();
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.innerHTML = `<video src="${d.url}#t=0.1" preload="metadata"></video>`;
                grid.appendChild(item);
            });
        }

        function openMyProfile() { openUserProfile(currentUser.uid); }

        function openEditProfile() {
            document.getElementById('edit-profile-page').style.display = 'flex';
            document.getElementById('edit-name-val').value = currentUser.displayName;
        }

        async function saveProfileName() {
            const newName = document.getElementById('edit-name-val').value;
            const now = Date.now();
            const userRef = db.collection('users').doc(currentUser.uid);
            const doc = await userRef.get();
            const lastChange = doc.data().lastInfoChange || 0;

            if (now - lastChange < (7 * 24 * 60 * 60 * 1000)) {
                document.getElementById('edit-error').style.display = 'block';
                return;
            }

            await userRef.update({
                name: newName,
                lastInfoChange: now
            });
            
            // Update Auth Profile too
            await currentUser.updateProfile({ displayName: newName });
            
            alert("เปลี่ยนชื่อสำเร็จ");
            closePage('edit-profile-page');
            openMyProfile();
        }

        // ==========================================
        // 7. Search & Utils
        // ==========================================
        function openPage(id) { document.getElementById(id).style.display = 'flex'; }
        function closePage(id) { document.getElementById(id).style.display = 'none'; }
        function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); }
        
        async function doSearch() {
            const txt = document.getElementById('search-input').value.toLowerCase();
            const resDiv = document.getElementById('search-results');
            resDiv.innerHTML = 'Loading...';
            
            // Search Videos (Simple array-contains logic)
            const snap = await db.collection('videos').where('searchKeywords', 'array-contains', txt).get();
            resDiv.innerHTML = '';
            snap.forEach(doc => {
                const d = doc.data();
                const item = document.createElement('div');
                item.className = 'grid-item';
                item.innerHTML = `<video src="${d.url}#t=0.1"></video>`;
                resDiv.appendChild(item);
            });
        }

        function toggleUI() {
            const uiElements = [document.getElementById('top-ui'), document.getElementById('bottom-ui')];
            document.querySelectorAll('.video-ui').forEach(e => uiElements.push(e));
            
            const isHidden = uiElements[0].style.display === 'none';
            uiElements.forEach(el => el.style.display = isHidden ? 'flex' : 'none');
        }

        function toggleHideLikes() {
            const icon = document.getElementById('icon-hide-likes');
            const isHidden = icon.classList.contains('fa-toggle-on');
            // Toggle Visual only for demo
            icon.className = isHidden ? 'fas fa-toggle-off' : 'fas fa-toggle-on';
            icon.style.color = isHidden ? '#888' : 'var(--primary)';
        }

        function shareVideo() {
            if(confirm("รีโพสต์คลิปนี้ไปยังหน้าของคุณ?")) {
                alert("รีโพสต์แล้ว (Feature จำลอง)");
            }
        }

    </script>
</body>
</html>